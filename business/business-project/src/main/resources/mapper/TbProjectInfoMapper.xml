<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yjtech.wisdom.tourism.project.mapper.TbProjectInfoMapper">
    <resultMap id="BaseResultMap" type="com.yjtech.wisdom.tourism.project.entity.TbProjectInfoEntity">
        <!--@mbg.generated-->
        <!--@Table tb_project_info-->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="project_name" jdbcType="VARCHAR" property="projectName"/>
        <result column="construction_requirement" jdbcType="VARCHAR" property="constructionRequirement"/>
        <result column="cooperation_method" jdbcType="VARCHAR" property="cooperationMethod"/>
        <result column="project_site_scale" jdbcType="VARCHAR" property="projectSiteScale"/>
        <result column="project_plan_footprint" jdbcType="VARCHAR" property="projectPlanFootprint"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="create_user" jdbcType="BIGINT" property="createUser"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="update_user" jdbcType="BIGINT" property="updateUser"/>
        <result column="deleted" jdbcType="TINYINT" property="deleted"/>
        <result column="project_build_area" jdbcType="VARCHAR" property="projectBuildArea"/>
        <result column="construction_condition" jdbcType="VARCHAR" property="constructionCondition"/>
        <result column="industrial_condition" jdbcType="VARCHAR" property="industrialCondition"/>
        <result column="market_outlook_forecast" jdbcType="VARCHAR" property="marketOutlookForecast"/>
        <result column="project_investment_content" jdbcType="VARCHAR" property="projectInvestmentContent"/>
        <result column="investment_total" jdbcType="VARCHAR" property="investmentTotal"/>
        <result column="funding_amount" jdbcType="VARCHAR" property="fundingAmount"/>
        <result column="private_capital" jdbcType="VARCHAR" property="privateCapital"/>
        <result column="payback_period" jdbcType="VARCHAR" property="paybackPeriod"/>
        <result column="company_name" jdbcType="VARCHAR" property="companyName"/>
        <result column="company_address" jdbcType="VARCHAR" property="companyAddress"/>
        <result column="project_concat" jdbcType="VARCHAR" property="projectConcat"/>
        <result column="project_phone" jdbcType="VARCHAR" property="projectPhone"/>
        <result column="post_code" jdbcType="VARCHAR" property="postCode"/>
        <result column="contact_landline" jdbcType="VARCHAR" property="contactLandline"/>
        <result column="contact_email" jdbcType="VARCHAR" property="contactEmail"/>
        <result column="contact_fax" jdbcType="VARCHAR" property="contactFax"/>
        <result column="concat_qq" jdbcType="VARCHAR" property="concatQq"/>
        <result column="service_unit_name" jdbcType="VARCHAR" property="serviceUnitName"/>
        <result column="project_service_concat" jdbcType="VARCHAR" property="projectServiceConcat"/>
        <result column="project_service_phone" jdbcType="VARCHAR" property="projectServicePhone"/>
        <result column="project_service_landline" jdbcType="VARCHAR" property="projectServiceLandline"/>
        <result column="support_desc" jdbcType="VARCHAR" property="supportDesc"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="company_id" jdbcType="VARCHAR" property="companyId"/>
        <result column="view_num" jdbcType="INTEGER" property="viewNum"/>
        <result column="area_code" jdbcType="VARCHAR" property="areaCode"/>
        <result column="area_name" jdbcType="VARCHAR" property="areaName"/>
        <result column="address" jdbcType="VARCHAR" property="address"/>
        <result column="longitude" jdbcType="VARCHAR" property="longitude"/>
        <result column="latitude" jdbcType="VARCHAR" property="latitude"/>
        <result column="is_top" jdbcType="TINYINT" property="isTop"/>
        <result column="project_map" jdbcType="VARCHAR" property="projectMap"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--@mbg.generated-->
        id, project_name, construction_requirement, cooperation_method, project_site_scale,
        project_plan_footprint, create_time, create_user, update_time, update_user, deleted,
        project_build_area, construction_condition, industrial_condition, market_outlook_forecast,
        project_investment_content, investment_total, funding_amount, private_capital, payback_period,
        company_name, company_address, project_concat, project_phone, post_code, contact_landline,
        contact_email, contact_fax, concat_qq, service_unit_name, project_service_concat,
        project_service_phone, project_service_landline, support_desc, `status`, company_id,view_num,
        area_code,area_name,address,longitude,latitude,is_top,project_map
    </sql>

    <!-- 查询列表 -->
    <select id="queryForList" parameterType="com.yjtech.wisdom.tourism.project.dto.ProjectQuery" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from
        tb_project_info
        <where>
            deleted = 0
            <if test="params != null">
                <if test="params.projectName != null and params.projectName != ''">
                    and project_name LIKE CONCAT('%',#{params.projectName},'%')
                </if>
                <choose>
                    <when test="params.status != null and params.status.size > 0">
                        and status in
                        <foreach collection="params.status" item="item" open="(" separator="," close=")">
                            #{item}
                        </foreach>
                    </when>
                    <otherwise>
                        and status = 2
                    </otherwise>
                </choose>
                <if test="params.areaCode != null and params.areaCode != ''">
                    and area_code LIKE CONCAT(#{params.areaCode},'%')
                </if>
                <if test="params.labelIdList != null and params.labelIdList.size > 0">
                    and id in
                    (select project_id from tb_project_label_relation
                    where
                    label_id in
                    <foreach collection="params.labelIdList" item="item" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                    GROUP BY project_id)
                </if>
            </if>
        </where>
        ORDER BY create_time DESC
    </select>

    <select id="queryProjectNumTrend" resultType="com.yjtech.wisdom.tourism.common.bean.BaseVO">
        SELECT
            DATE_FORMAT( create_time, '%c' ) `name`,
            COUNT( id ) `value`
        FROM
            tb_project_info
        WHERE
            status IN ( 0, 1, 2 )
            and create_time BETWEEN #{beginTime} AND #{endTime}
        GROUP BY
            `name`
    </select>

    <select id="queryAreaProjectNumPie" resultType="com.yjtech.wisdom.tourism.common.bean.BaseVO">
        SELECT
            area_name `name`,
            COUNT( id ) `value`
        FROM
            tb_project_info
        WHERE
            `status` IN ( 0, 1, 2 )
            and area_name is not null
        GROUP BY
            area_code
        ORDER BY value DESC
    </select>

    <select id="queryProjectPlanFootprintPie" resultType="com.yjtech.wisdom.tourism.common.bean.BaseVO">
        SELECT a.name,IFNULL(b.value ,0) value
        FROM
            ( SELECT '0-5亩' AS `name` UNION SELECT '5-10亩' AS `name` UNION SELECT '10-15亩' AS `name` UNION SELECT '15-20亩' AS `name` UNION SELECT '20亩以上' AS `name` ) a
            LEFT JOIN
            (SELECT name,COUNT(1) `value` FROM
            (
            SELECT
            CASE
            WHEN project_plan_footprint <![CDATA[>]]> 0 and project_plan_footprint <![CDATA[<]]> 5 THEN '0-5亩'
            WHEN project_plan_footprint <![CDATA[>=]]> 5 and project_plan_footprint <![CDATA[<]]> 10  THEN '5-10亩'
            WHEN project_plan_footprint <![CDATA[>=]]> 10 and project_plan_footprint <![CDATA[<]]> 15  THEN '10-15亩'
            WHEN project_plan_footprint <![CDATA[>=]]> 15 and project_plan_footprint <![CDATA[<]]> 20  THEN '15-20亩'
            WHEN project_plan_footprint <![CDATA[>=]]> 20 THEN '20亩以上' END `name`
            FROM
            tb_project_info
            WHERE
            project_plan_footprint IS NOT NULL
            )t
            GROUP BY name) b
        ON a.name = b.name
    </select>

    <select id="queryInvestmentTotalTrend" resultType="com.yjtech.wisdom.tourism.common.bean.BaseVO">
        SELECT
            a.name,IFNULL(b.value,0)value
        FROM
            ( SELECT '百万级别' AS `name` UNION SELECT '千万级别' AS `name` UNION SELECT '亿级' AS `name` UNION SELECT '十亿级' AS `name` UNION SELECT '十亿级以上' AS `name` ) a
            LEFT JOIN
            (SELECT name,COUNT(1) `value` FROM
            (
            SELECT
            CASE
            WHEN investment_total <![CDATA[>=]]> 0.01 and investment_total <![CDATA[<]]> 0.1 THEN '百万级别'
            WHEN investment_total <![CDATA[>=]]> 0.1 and investment_total <![CDATA[<]]> 1 THEN '千万级别'
            WHEN investment_total <![CDATA[>=]]> 1 and investment_total <![CDATA[<]]> 10 THEN '亿级'
            WHEN investment_total <![CDATA[>=]]> 10 and investment_total <![CDATA[<]]> 100 THEN '十亿级'
            WHEN investment_total <![CDATA[>=]]> 100 THEN '十亿级以上' END `name`
            FROM
            tb_project_info
            WHERE
            investment_total IS NOT NULL
            )t
            GROUP BY name) b
        ON a.name = b.name
    </select>

    <select id="queryProjectAmountTrend" resultType="com.yjtech.wisdom.tourism.project.vo.ProjectAmountVo">
        SELECT
            DATE_FORMAT( create_time, '%c' ) `name`,
            IFNULL(sum( investment_total ),0) investmentTotal,
            IFNULL(sum( funding_amount ),0) fundingAmount
        FROM
            tb_project_info
        WHERE
            `status` = 2 and
            create_time BETWEEN #{beginTime} AND #{endTime}
        GROUP BY
            `name`
    </select>
</mapper>